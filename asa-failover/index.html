<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>ASA Failover – Spurge Laurels</title> <meta name="description" content="Petticoated Swashbuckler"> <meta name="keywords" content="firewall, network"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://daphne-reed.io/assets/img/logo.png"> <meta name="twitter:title" content="ASA Failover"> <meta name="twitter:description" content="Setting up a failover between Cisco ASA units proved to be far simpler than I anticipated, and a very useful technique if you value the availability and potential load-balancing it has to offer. In the example below, I will demonstrate an Active/Standby configuration, which does not allow for load-balanced operation. For load balancing, you will need to run in Active/Active configuration and you will need to configure them in context mode."> <meta name="twitter:site" content="@spurgelaurels"> <meta name="twitter:creator" content="@spurgelaurels"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="ASA Failover"> <meta property="og:description" content="Setting up a failover between Cisco ASA units proved to be far simpler than I anticipated, and a very useful technique if you value the availability and potential load-balancing it has to offer. In the example below, I will demonstrate an Active/Standby configuration, which does not allow for load-balanced operation. For load balancing, you will need to run in Active/Active configuration and you will need to configure them in context mode."> <meta property="og:url" content="https://daphne-reed.io/asa-failover/"> <meta property="og:site_name" content="Spurge Laurels"> <meta property="og:image" content="https://daphne-reed.io/assets/img/logo.png"> <link rel="canonical" href="https://daphne-reed.io/asa-failover/"> <link href="https://daphne-reed.io/feed.xml" type="application/atom+xml" rel="alternate" title="Spurge Laurels Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://daphne-reed.io/assets/css/main.css"> <!-- JS --> <script src="https://daphne-reed.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://daphne-reed.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://daphne-reed.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://daphne-reed.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://daphne-reed.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://daphne-reed.io/favicon.png"> <link rel="shortcut icon" href="https://daphne-reed.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(https://daphne-reed.io/assets/img/winterTree.png); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117258368-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-117258368-1'); </script> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://daphne-reed.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://daphne-reed.io/assets/img/logo.png" alt="Spurge Laurels photo" class="author-photo"> <h4>Spurge Laurels</h4> <p>Petticoated Swashbuckler</p> </li> <li><a href="https://daphne-reed.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="https://twitter.com/spurgelaurels" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="https://facebook.com/daphnelydiareed" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a> </li> <li> <a href="https://linkedin.com/in/spurgelaurels" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="https://github.com/spurgelaurels" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://daphne-reed.io/posts/">All Posts</a></li> <li><a href="https://daphne-reed.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://daphne-reed.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>ASA Failover</h1> <h4>08 Jul 2013</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://daphne-reed.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>Setting up a failover between Cisco ASA units proved to be far simpler than I anticipated, and a very useful technique if you value the availability and potential load-balancing it has to offer. In the example below, I will demonstrate an Active/Standby configuration, which does not allow for load-balanced operation. For load balancing, you will need to run in Active/Active configuration and you will need to configure them in context mode.</p> <p><a href="/assets/img/oldblog/asa.png"><img src="/assets/img/oldblog/asa-210x300.png" alt="Topology"></a></p> <p>Our topology will include 2 ASA 5520 units, ASA4 and ASA5. After you’ve configured your basic ASA operation, we’ll want to configure our interfaces. The difference between a failover setup and a normal setup is the standby address. The IP used for a standby address will end up being the address of the secondary unit while it’s in standby mode. If the secondary unit goes active, it will then assume the first address. So, the configuration is set on ASA4 is as follows:</p> <div class="highlighter-rouge"><pre class="highlight"><code>interface Ethernet0/0
 nameif OUTSIDE
 security-level 0
 ip address 10.0.0.1 255.255.255.0 standby 10.0.0.2

interface Ethernet0/1
 nameif INSIDE
 security-level 100
 ip address 172.16.0.1 255.255.255.0 standby 172.16.0.2
</code></pre></div> <p>Once set, enable the interfaces and test that they’re operational. Next, we’re going to configure the failover itself, and then configure interface ethernet0/3 as our dedicated failover link.</p> <p>First, shut down ethernet0/3 on ASA4.</p> <div class="highlighter-rouge"><pre class="highlight"><code>conf t
int e0/3
shut
</code></pre></div> <p>Next, configure ASA4 for the following failover directives:</p> <div class="highlighter-rouge"><pre class="highlight"><code>failover
failover lan unit primary
failover lan interface FAIL Ethernet0/3
failover interface ip FAIL 192.168.1.1 255.255.255.0 standby 192.168.1.2
</code></pre></div> <p>This will set ASA4 as the primary unit, creating an interface named FAIL and attaching it to physical interface Ethernet0/3 on 192.168.1.1. We can leave ethernet0/3 shutdown for now.</p> <p>Next, we want to configure ASA5 with the same interface configuration, only in reverse:</p> <div class="highlighter-rouge"><pre class="highlight"><code>interface Ethernet0/0
 nameif OUTSIDE
 security-level 0
 ip address 10.0.0.2 255.255.255.0 standby 10.0.0.1

interface Ethernet0/1
 nameif INSIDE
 security-level 100
 ip address 172.16.0.2 255.255.255.0 standby 172.16.0.1
</code></pre></div> <p>Then we configure the secondary failover:</p> <div class="highlighter-rouge"><pre class="highlight"><code>failover
failover lan unit secondary
failover lan interface FAIL Ethernet0/3
failover interface ip FAIL 192.168.1.1 255.255.255.0 standby 192.168.1.2
</code></pre></div> <p>Then finally, we can enable e0/3 on both ASA4 and ASA5 with</p> <div class="highlighter-rouge"><pre class="highlight"><code>conf t 
int e0/3
no shut
</code></pre></div> <p>At this point, you should see some console logging data showing synchronization between the ASA units, as they negotiate configuration data and enable the sync link on e0/3. Once complete, you will find the following output from running a ‘show failover’ on each host:</p> <div class="highlighter-rouge"><pre class="highlight"><code>&lt;strong&gt;ASA4&lt;/strong&gt;# show failover
Failover On
Failover unit &lt;strong&gt;Primary&lt;/strong&gt;
Failover LAN Interface: FAIL Ethernet0/3 (up)
Unit Poll frequency 1 seconds, holdtime 15 seconds
Interface Poll frequency 5 seconds, holdtime 25 seconds
Interface Policy 1
Monitored Interfaces 2 of 250 maximum
Version: Ours 8.0(2), Mate 8.0(2)
Last Failover at: 00:00:06 UTC Nov 30 1999
        This host: Primary - Active
                Active time: 3135 (sec)
                slot 0: empty
                  Interface &lt;strong&gt;OUTSIDE (10.0.0.1)&lt;/strong&gt;: Normal
                  Interface &lt;strong&gt;INSIDE (172.16.0.1)&lt;/strong&gt;: Normal
                slot 1: empty
        Other host: Secondary - Standby Ready
                Active time: 0 (sec)
                slot 0: empty
                  Interface &lt;strong&gt;OUTSIDE (10.0.0.2)&lt;/strong&gt;: Normal
                  Interface &lt;strong&gt;INSIDE (172.16.0.2)&lt;/strong&gt;: Normal
                slot 1: empty





&lt;strong&gt;ASA4&lt;/strong&gt;# show failover
Failover On
Failover unit &lt;strong&gt;Secondary&lt;/strong&gt;
Failover LAN Interface: FAIL Ethernet0/3 (up)
Unit Poll frequency 1 seconds, holdtime 15 seconds
Interface Poll frequency 5 seconds, holdtime 25 seconds
Interface Policy 1
Monitored Interfaces 2 of 250 maximum
Version: Ours 8.0(2), Mate 8.0(2)
Last Failover at: 00:00:01 UTC Nov 30 1999
        This host: Secondary - Standby Ready
                Active time: 0 (sec)
                slot 0: empty
                  Interface&lt;strong&gt; OUTSIDE (10.0.0.2)&lt;/strong&gt;: Normal
                  Interface &lt;strong&gt;INSIDE (172.16.0.2)&lt;/strong&gt;: Normal
                slot 1: empty
        Other host: Primary - Active
                Active time: 3138 (sec)
                slot 0: empty
                  Interface &lt;strong&gt;OUTSIDE (10.0.0.1)&lt;/strong&gt;: Normal
                  Interface &lt;strong&gt;INSIDE (172.16.0.1)&lt;/strong&gt;: Normal
                slot 1: empty
</code></pre></div> <p>I’ve emboldened a few key points in the failover output.</p> <ol> <li> <p>You’ll notice that the hostname is the same on both ASA units. This is because they’re essentially a single logical entity now, with one unit acting as the primary, and syncing data to the secondary.</p> </li> <li> <p>You’ll also notice that the primary host has the x.x.x.1 addresses for its interfaces, while the secondary has the x.x.x.2 addresses. Watch what happens next…</p> </li> </ol> <p>To test our failover, log into ASA4, and type “no failover active”, which will tell the active failover host to drop to standby mode. <strong>DO NOT</strong> type “no failover”, as this will turn off failover altogether, and this would be bad on a production box. You’ll see in the output of “show failover” that the IP addresses of the INSIDE and OUTSIDE interfaces have swapped between the Primary and Secondary hosts.</p> <p><strong>ASA4</strong></p> <div class="highlighter-rouge"><pre class="highlight"><code>This host: Primary - Standby Ready
                Active time: 3552 (sec)
                slot 0: empty
                  Interface OUTSIDE (10.0.0.2): Normal (Waiting)
                  Interface INSIDE (172.16.0.2): Normal (Waiting)
                slot 1: empty
        Other host: Secondary - Active
                Active time: 25 (sec)
                slot 0: empty
                  Interface OUTSIDE (10.0.0.1): Normal (Waiting)
                  Interface INSIDE (172.16.0.1): Normal (Waiting)
                slot 1: empty
</code></pre></div> <p><strong>ASA5</strong></p> <div class="highlighter-rouge"><pre class="highlight"><code>This host: Primary - Standby Ready
                Active time: 3552 (sec)
                slot 0: empty
                  Interface OUTSIDE (10.0.0.2): Normal (Waiting)
                  Interface INSIDE (172.16.0.2): Normal (Waiting)
                slot 1: empty
        Other host: Secondary - Active
                Active time: 25 (sec)
                slot 0: empty
                  Interface OUTSIDE (10.0.0.1): Normal (Waiting)
                  Interface INSIDE (172.16.0.1): Normal (Waiting)
                slot 1: empty
</code></pre></div> <p>To summarize, we have created a configuration with two modes, active and standby. Then we’ve created a link between our two devices, over which they synchronize their configuration and communicate their states. In the event that the Primary device fails, the Secondary device already has both a working replicated configuration, but also a copy of open connection states in memory. This allows for a clean cutover with no packet loss.</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://daphne-reed.io/tags/#firewall" title="Pages tagged firewall" class="tag"><span class="term">firewall</span></a><a href="https://daphne-reed.io/tags/#network" title="Pages tagged network" class="tag"><span class="term">network</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://daphne-reed.io/asa-failover/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://daphne-reed.io/asa-failover/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://daphne-reed.io/asa-failover/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="https://daphne-reed.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://daphne-reed.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://daphne-reed.io/assets/js/jquery.goup.min.js"></script> <script src="https://daphne-reed.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://daphne-reed.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://daphne-reed.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'spurgelaurels'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117258368-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-117258368-1'); </script> </body> </html>
